# Exploit Protection Bypassing

## Detect Enabled Protections <a href="#docs-internal-guid-39923e30-7fff-1eb7-44df-03cf31a836cb" id="docs-internal-guid-39923e30-7fff-1eb7-44df-03cf31a836cb"></a>

You can use the checksec script from pwntools for ELF executables:

```
pwn checksec target
```

## Return Oriented Programming <a href="#docs-internal-guid-f62655c6-7fff-59ca-6029-47674aaea71d" id="docs-internal-guid-f62655c6-7fff-59ca-6029-47674aaea71d"></a>

### **Finding ROP Gadgets**

#### **msfelfscan**

Benefits:

* Is more abstract, searches for things that get you the desired result instead of specific instructions

Drawbacks:

* Has no option to only search executable memory regions afaik.
* **Doesn't work** if you're on a 64-bit machine and trying to find ROP gadgets for a 32-bit binary

**Installation**

You need metasploit-framework:

```
sudo apt install metasploit-framework
```

Then you need to install the necessary ruby gem(s):

```
sudo gem install rex-bin_tools
```

And after that, you should be able to use msfelfscan:

```
locate msfelfscan
/usr/share/metasploit-framework/vendor/bundle/ruby/2.7.0/bin/msfelfscan
```

#### **Usage**

Useful flags:

* `-j` to look for jumps to specific places/things

For example, the following command looks for jumps to esp:

```
msfelfscan -j esp /path/to/executable
```

**Warning**: It will also display gadgets that are in non-executable memory segments.

You can use `readelf` to see which memory segments are executable. Look for LOAD types with the **E** (execute) flag. For example:

```
readelf executable --segments
Type           Offset   VirtAddr   PhysAddr   FileSiz MemSiz  Flg Align
LOAD           0x001000 0x08049000 0x08049000 0x6d444 0x6d444 R E 0x1000
```

In this case, a memory segment starting at 0x08049000 with a size of 0x6d444 is executable (ends at 0x80B6444).&#x20;

Here's how you can filter out gadgets in a specific memory segment using awk:

```
msfelfscan target -j esp | awk '{
if (strtonum($1) >= 0x08049000 && strtonum($1) <= 0x080b6444)
        print $0
}'
```
